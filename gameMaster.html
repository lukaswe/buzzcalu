<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BuzzCaLu GameMaster Screen</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="node_modules/socket.io-client/dist/socket.io.js"></script>
    <script src="libraries/jquery-3.2.1.min.js"></script>
    <link href="styles/gameMaster.css" type="text/css" rel="stylesheet">
</head>


<script>
    var socket = io.connect();
    var schnellster;
    var playerArray = new Array;
    var fragenPunkte = 100;
    var questionArray = new Array
    var tdId = 100;
    var currentQuestionObj;

    //Für Bilder im .text Feld "Bild" eingeben. Auf Großschreibung achten!
    questionArray = [
        {
            "text": "An welcher Gameshow nahm Angela Merkel einst teil?",
            "pkte": 100,
            "val": 0, "superquestion": 0,
            "picture":1, "erledigt":0},
        {
            "text": "Warum tragen die Herren auf dem Wiener Opernball weiße Fliegen?",
            "pkte": 100,
            "val": 0,
            "superquestion": 0,
            "picture":0,
            "erledigt":0
        },
        {
            "text": "Haben Fliegen Flügel?",
            "pkte": 100, "val": 0,
            "superquestion": 0,
            "picture":0, "erledigt":0
        },
        {
            "text": "Haben Fliegen Flügel?", "pkte": 100, "val": 0, "superquestion": 0,
            "picture":0,
            "erledigt":0
        },

        {
            "text": "Wie viele Golfbälle liegen auf dem Mond?",
            "pkte": 200, "val": 0, "superquestion": 1,
            "picture":0,
            "erledigt":0
        },
        {
            "text": "Wer war als Tontechniker für die Ich bin ein Berliner-Rede von John F. Kennedy verantwortlich ?",
            "pkte": 200,
            "val": 0,
            "superquestion": 0,
            "picture":0, "erledigt":0
        },
        {
            "text": "Haben Fliegen Flügel?",
            "pkte": 200, "val": 0, "superquestion": 0,
            "picture":0,
            "erledigt":0
        },
        {
            "text": "Haben Fliegen Flügel?", "pkte": 200, "val": 0,
            "superquestion": 0, "picture":0, "erledigt":0
        },

        {
            "text": "Was hat das Münchener Oktoberfest im Gegensatz zu anderen Volksfesten zu bieten?",
            "pkte": 300,
            "val": 0,
            "superquestion": 0,
            "picture":0, "erledigt":0
        },
        {
            "text": "Haben Fliegen Flügel?",
            "pkte": 300, "val": 0, "superquestion": 0,
            "picture":0, "erledigt":0
        },
        {
            "text": "Haben Fliegen Flügel?",
            "pkte": 300, "val": 0, "superquestion": 0,
            "picture":0, "erledigt":0
        },
        {
            "text": "Was zur Hölle?", "pkte": 300,
            "val": 0, "superquestion": 0,
            "picture":0, "erledigt":0},

        {
            "text": "Bild", "pkte": 400,
            "val": 0, "superquestion": 0,
            "picture":0, "erledigt":0
        },
        {
            "text": "Haben Fliegen Flügel?",
            "pkte": 400, "val": 0,
            "superquestion": 0, "picture":0, "erledigt":0
        },
        {
            "text": "Papst Franziskus ist Ehrenmitglied des Fußballvereins ...?",
            "pkte": 400,
            "val": 0,
            "superquestion": 0,
            "picture":0,
            "erledigt":0
        },
        {
            "text": "Was zur Hölle?",
            "pkte": 400,
            "val": 0,
            "superquestion": 0,
            "picture":0,
            "erledigt":0
        }];


    /**Client-Server Kommunikation**/
        //Clients verbinden sich
    socket.on('playerList', function (nicknameObj, playerArray2) {
        //Array mit Spielern füllen
        playerArray = playerArray2;
        console.log(nicknameObj.nickname + " just connected!");
        start();

    });

    socket.on('fastest player', function (player) {
        //document.getElementById("erster-text").innerHTML = player;
        $('#schnellster-text').text(player.nickname);
        // console.log("this.schnellster "+ this.schnellster.nickname);
        console.log("this.player " + player.nickname);
        schnellster = player;
        console.log("this.schnellster2 " + schnellster.nickname);
        console.log("this.player2 " + player.nickname);
    });

    /**Seitenspezifische Funktionalitäten**/
    function trueAnswer() {
        var schnellster2 = $("#schnellster-text").html();

        //var  schnellster2 = document.getElementById("schnellster-text").innerText();
        console.log("tdid: " + tdId);
       // socket.emit('showNothing', questionArray, tdId, indx);
        document.getElementById(tdId).innerHTML = "erledigt";
        console.log("this.playerArray" + playerArray[0].nickname);
        playerArray.forEach(function (player) {
            if (schnellster2 == player.nickname) {
                player.pkte += currentQuestionObj.pkte;
                console.log("schnellster Spieler, this.playerArray: " + playerArray[0].nickname);
                socket.emit('trueAnswer', player, playerArray);
            }

        });
        $('#schnellster-text').text("...");
        start();
    }

    function wrongAnswer() {
        console.log("in wrongAnswer, playerArray[0].nickname:  " + playerArray[0].nickname);
        //schnellster.pkte -= fragenPunkte;
        playerArray.forEach(function (player) {
            if (schnellster.nickname == player.nickname) {
                console.log("in wrongAnswer, this.playerArray:  " + player.nickname);
                console.log("in wrongAnswer, playerpkte:  " + player.pkte);
                console.log("in wrongAnswer, currentQuestionObj.pkte:  " +currentQuestionObj.pkte);
                console.log("in wrongAnswer, currentQuestionObj.text:  " +currentQuestionObj.text);
                player.pkte -= currentQuestionObj.pkte;
                console.log("in wrongAnswer, playerpkte:  " + player.pkte);
                socket.emit('wrongAnswer', player, playerArray);
            }
        });
        $('#schnellster-text').text("...");
        start();
    }
    ;

    socket.on('trueAnswer', function (playa, playerArray, questionArray) {
        schnellster = playa;
    });

    socket.on('wrongAnswer', function (player, playerArray9) {
        playerArray = playerArray9;
        console.log("socket on wrongArray, playerArray9:  " + playerArray9[0].nickname);
    });


    //Spieler in Tabelle eintragen
    function start() {
        var tbody = document.getElementById("ctbody");
        console.log("in start");
        renderRows(tbody);

    }

    function renderRows(tbody) {
        tbody.innerHTML = '';
        console.log("in render ROws");

        //playerArray = JSON.parse(playerArray);
        console.log("playerArray: " + playerArray);
        playerArray.forEach(function (player) {
            //neue Zelie
            console.log("player: " + player.pkte);
            var row = document.createElement("tr");

            //neue Spalten
            var playerNameTd = document.createElement("td"),
                    playerPkteTd = document.createElement("td");
            playerColorTd = document.createElement("td");

            playerNameTd.appendChild(document.createTextNode(player.nickname));
            playerPkteTd.appendChild(document.createTextNode(player.pkte));

            //   playerPkteTd.appendChild(document.createTextNode(player.pkte));
            playerColorTd.appendChild(document.createTextNode(player.color));

            row.appendChild(playerNameTd);
            row.appendChild(playerPkteTd);
            row.appendChild(playerColorTd);

            //Eintrag entfernen
            //   playerXoxoTd.onclick = function () {
            //      row.parentElement.removeChild(row);
            //entfernen(player);

            //}

            tbody.appendChild(row);


        });
    }

    window.onload = function () {
        questionStart();
    }

    function questionStart() {
        // socket.emit('questionStart', questionArray);
        var j = 0;
        questionArray.forEach(function (question) {
            console.log("question: " + question.text);

            $('#question' + [j]).text(question.text);
            //    document.getElementById("question" + [j]).style = "visibility:visible;";
            j++;
        });
    }

/**Function on click auf die Tabelle**/
    function showQuestion(tdId2) {
        tdId = tdId2;
        /**Hier anzahl der fragen anpassen**/
        //for (var anzahlDerFragen = 0; anzahlDerFragen < 16; anzahlDerFragen ++) {
        if (tdId.length < 10) {
             indx = tdId2.substring(tdId2.length - 1, tdId2.length);
        } else {
             indx = tdId2.substring(tdId2.length - 2, tdId2.length);
        }


       // console.log("this.questionArray: " + questionArray[indx].text + "indx: " + indx);
        //NICht nur show question sondern auch BuzzerEnablen
       // console.log("this.questionArray.val: " + questionArray[indx].val);

//        console.log("this.questionArray.val: " + questionArray[indx].val);
        if (questionArray[indx].erledigt == 0) {
            if (questionArray[indx].val % 2 == 1) {
                socket.emit('showNothing', questionArray, tdId2, indx);
                document.getElementById(tdId).innerHTML = "erledigt";
            } else {
                socket.emit('showQuestion', questionArray, tdId2, indx);
            }
            currentQuestionObj = questionArray[indx];
            questionArray[indx].val += 1;
            questionArray[indx].erledigt = 1;
        }else{
            console.log("Die Frage ist schon erledigt.")
        }
    }

    function showPicture(tdId2) {
        tdId = tdId2;
        /**Hier anzahl der fragen anpassen**/
        //for (var anzahlDerFragen = 0; anzahlDerFragen < 16; anzahlDerFragen ++) {
        if (tdId.length < 10) {
            indx = tdId2.substring(tdId2.length - 1, tdId2.length);
        } else {
            indx = tdId2.substring(tdId2.length - 2, tdId2.length);
        }

        //NICht nur show question sondern auch BuzzerEnablen

        if (questionArray[indx].val % 2 == 1) {
            socket.emit('showNothing', questionArray, tdId2, indx);
            document.getElementById(tdId).innerHTML = "erledigt";
        } else {
            socket.emit('showPicture', questionArray, tdId2, indx);
        }
        currentQuestionObj=  questionArray[indx];
        questionArray[indx].val += 1;

    }

    socket.on('showQuestion', function (questionArray, tdId2, indx2) {
        console.log(" showQuestion " );

    });
    socket.on('showPicture', function (questionArray, tdId2, indx2) {
        console.log(" showPicture" );
        //questionArray[indx].style()
    });
    socket.on('showSuperQuestion', function (questionArray, tdId2, indx2) {
        console.log(" showSuperQuestion " );
    });

</script>
<body>




<!--Teilnehmer Tabelle-->
<div><h1 id="heins">Wer ist dabei?</h1></div>
<div class="col-lg-5" style="margin-left: 10px">

    <table id="playerTable" class="dataList table">
        <thead>
        <tr>
            <th style="padding-right: 40px">Name</th>
            <th style="padding-right: 40px">Punktzahl</th>
            <th style="padding-right: 40px">Farbe</th>
            <!--  <th style="padding-right: 25px">xoxo</th>
              <th style="padding-right: 25px"></th>-->

        </tr>
        </thead>
        <tbody id="ctbody">
        <tr>
            <td style="padding-right: 60px"></td>
            <td style="padding-right: 80px"></td>
            <td style="padding-right: 80px"></td>
            <!--   <td style="padding-right: 25px"></td>
               <td style="padding-right: 25px"></td>-->

        </tr>


        </tbody>

        <!-- Placeholder -->
    </table>

</div>
<!--Fragen Tabelle-->
<div class="questionContainer2-css">

    <table id="questionTable" class="questionUeberschrift-css">
        <thead>
        <tr>
            <th style="padding-left: 25px">Mainstockheim</th>
            <th style="padding-left: 25px">Familie</th>
            <th style="padding-left: 25px">Skuriles</th>
            <th style="padding-left: 25px">Romantisch</th>

        </tr>
        </thead>
        <tbody id="ctbody2">
        <tr>

            <!--  <td class="questionBoxes-css" id="question-text0" style="visibility:hidden;">Question</td>-->
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question0">100</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question1">100</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question2">100</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question3">100</td>
        </tr>
        <tr>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question4">200</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question5">200</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question6">200</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question7">200</td>
        </tr>
        <tr>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question8">300</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question9">300</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question10">300</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question11">300</td>


        </tr>
        <tr>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question12">400</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question13">400</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question14">400</td>
            <td class="questionBoxes2-css" onclick="showQuestion(this.id)" id="question15">400</td>


        </tr>


        </tbody>

        <!-- Placeholder -->
    </table>

</div>


</br>
</br>
</br>
</br>
</br>
</br>

<div id="schnellster">
    <h3 id="schnellster-text"> ... </h3>
</div>

<!--<form action="">
  <input id="m" autocomplete="off" /><br>-->
<button class="answbtn-css"
        type="button"
        id="rightAnswer"
        onclick="trueAnswer()">Right
</button>
<br>

<button class="answbtn-css"
        type="button"
        id="wrongAnswer"
        onclick="wrongAnswer()">Wrong
</button>
<br>
<!--<button type = "submit">Buzz!</button>
</form>-->

</body>
</html>
