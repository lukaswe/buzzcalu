<!doctype html>
<html>
<head>
    <title>Client</title>
    <script src="libraries/jquery-3.2.1.min.js"></script>
    <link href="styles/client.css" rel="stylesheet">
    <!-- <script src="/socket.io/socket.io.js"></script>-->
    <script src="/socket.io/socket.io.js"></script>
    <!--<script src="http://localhost:3000/node_modules/socket.io-client/dist/socket.io.js"></script>-->
    <!--<script src="/node_modules/socket.io-client/dist/socket.io.js"></script>-->
    <!--    <link href="styles/overview.css" rel="stylesheet">-->
    <script language="javascript" type="text/javascript" src="js/client.js"></script>

</head>


<script>
    var obj = {},
        socket = io.connect(),
        //  socket = io.connect(),
        mystorage = localStorage,
        ich = {},

        currColor;
    //Daten vom Server empfangen bzw


    $(document).ready(function () {

        console.log("ready(function)", mystorage.getItem('id'));
        if (mystorage.getItem('id') !== null) {
            console.log('und überhautp: ' + mystorage.getItem('id'));
            console.log("reconnnnect: ");
            //    socket.emit('reconnect');
            reconnect();
            // socket.emit('reconnect', obj);
        } else {
            console.log("neu");
        }
    });


    socket.on('reconnectPlayer', function (player) {
        console.log(player.id);
        console.log(mystorage.getItem('id'));
        if (player.id == mystorage.getItem('id')) {
            console.log("User ist reconnected" + player.nickname);
            buttonVisibility();
            $('#subheading').text("Du bist bereits als: " + mystorage.getItem('playerName') + " eingeloggt, also sei bereit, " + mystorage.getItem('playerName') + "!");
        }
    });

    function reconnect() {
        buttonVisibility();
        $('#subheading').text("Du bist bereits als: " + mystorage.getItem('playerName') + " eingeloggt, also sei bereit, " + mystorage.getItem('playerName') + "!");
        var id2 = mystorage.getItem('id');
        console.log("reconnect ID: " + id2);
        //  console.log("PlayerObject: " + playerObject.nickname + ", " + playerObject.id + ", " + playerObject.color + ", " + playerObject.pkte);

        socket.emit('reconnectPlayer', id2);
    }

    function save_name() {

        if (mystorage.getItem('nickname') != null) {
            //  reconnect();
            console.log("ist schon");
        } else {

            //console.log("Neuanmeldung, als: " + $('#username').val());
            document.getElementById("username").disabled = true;
            document.getElementById("username").style = "visibility:hidden;";
            document.getElementById("submit-btn").disabled = true;
            document.getElementById("submit-btn").style = "visibility:hidden;";
            //  obj = ({"id": mystorage.getItem('id'), 'nickname': $('#username').val(), "pkte": 0, "gameColor": "white"});
            //   mystorage.setItem('obj', JSON.stringify(obj));
            mystorage.setItem('playerName', $('#username').val());
            var id = Math.random();
            console.log('id: ' + id);
            mystorage.setItem('id', id);
            //  console.log("obej: " + obj.id);
            //console.log("mystoragegetitem: "+mystorage.getItem('obj'));


            socket.emit('createPlayer', $('#username').val(), id); //Former 'set nickname'
            //    });
            // var myJSON = JSON.stringify(obj);
        }

    };

    socket.on('getPlayerObject', function (druecker, drueckerArray, questionArray) {
    });


    function buttonVisibility() {
        document.getElementById("username").disabled = true;
        document.getElementById("username").style = "visibility:hidden;";
        document.getElementById("submit-btn").disabled = true;
        //   document.getElementById("subheading").style = "visibility:hidden;";
        document.getElementById("submit-btn").style = "visibility:hidden;";
        document.getElementById("buzzerBtn").style = "visibility:visible;";
    }


    socket.on('emptyLocalstorage', function () {
        console.log("Localstorage wird gelöscht");
        mystorage.clear();
        //  keyName: Name des Eintrags
        // keyValue: string mit zu speicherndem Eintrag
        location.reload();
        //document.getElementById("buzzerBtn").style = "visibility:visible;";
        //$('#subheading').text("Sei bereit, " + obj.nickname + "!");

    });

    socket.on('playerList', function (playerObject, playerArray) {
        playerArray.forEach(function (playa) {
            if (mystorage.getItem('playerName') == playa.nickname) {
                // mystorage.setItem('id', playerObject.id); //speichern eines Eintrags mit 2 Werten.


                //  keyName: Name des Eintrags
                // keyValue: string mit zu speicherndem Eintrag
                // console.log("PlayerObject: " + playerObject.nickname + ", " +playerObject.id + ", " + playerObject.color + ", " + playerObject.pkte);
                document.getElementById("buzzerBtn").style = "visibility:visible;";
                $('#subheading').text("Sei bereit, " + playerObject.nickname + "!");

            } else {
                console.log("war schon");
                document.getElementById("buzzerBtn").style = "visibility:visible;";
                $('#subheading').text("Sei bereit, " + mystorage.getItem('playerName') + "!");
            }
        });
    });


    socket.on('fastest player', function (player) {
        $('#buzzerBtn').css('background-color', 'grey');
        console.log("meine id in fastest: " + mystorage.getItem('id'));

        console.log("Der fastest player lautet: " + player.nickname);
        console.log("Der fastest player id lautet: " + player.id);
        //BuzzerBtn ausgrauen, um ihn nur einmal drücken zu können.


        console.log("ich.nickname: " + mystorage.getItem('playerName'));
        if (mystorage.getItem('playerName') == player.nickname) {
            $('body').css('background', 'green');
            $('#buzz-text').text("Glückwunsch, Du bist dran!");
            console.log("Glückwunsch, Du bist dran!");
            changeColor('green');
        }
        else {
            $('#buzz-text').text("Zu Langsam, " + player.nickname + " ist dran!");
            $('body').css('background', 'red');
            console.log("Zu Langsam,");
            changeColor('grey');
        }
    });

    socket.on('trueAnswer', function (druecker, drueckerArray, questionArray) {
        console.log("meine id in true: " + mystorage.getItem('id'));
        console.log(druecker.nickname + " kriegt Punkte!!");
        $('#buzzerBtn').prop('disabled', true);
        changeColor('white');
    });
    socket.on('giveUp', function (druecker, drueckerArray, questionArray) {
        console.log("Niemand kriegt Punkte!!");
        $('#buzzerBtn').prop('disabled', true);
        changeColor('white');
    });

    socket.on('wrongAnswer', function (druecker, drueckerArray) {
        console.log("meine id in false: " + mystorage.getItem('id'));
        console.log(druecker.nickname + " kriegt leider keine Punkte!!");
        $('#buzzerBtn').prop('disabled', false);
        //Buzzer wieder disablen
        changeColor('white');
    });

    //Buzzer wieder enablen!
    socket.on('showQuestion', function (questionArray5, tdId5, indx5) {
        $('#buzzerBtn').prop('disabled', false);
        $('#buzzerBtn').css('background-color', 'red');
        $('#buzz-text').text("Sei bereit, " + $('#username').val() + "!");

    });

    socket.on('showPicture', function (questionArray5, tdId5, indx5) {
        $('#buzzerBtn').prop('disabled', false);
        $('#buzz-text').text("Sei bereit, " + $('#username').val() + "!");

    });

    socket.on('showSuperQuestion', function (questionArray5, tdId5, indx5) {
        $('#buzzerBtn').prop('disabled', false);
        $('#buzz-text').text("Sei bereit, " + $('#username').val() + "!");

    });


    function changeColor(colorName) {
        document.body.style.backgroundColor = colorName;
        currColor = colorName;
    }


    function send_buzz() {
        console.log("send_buzz Test: " + mystorage.getItem('id'));
        $('#buzzerBtn').prop('disabled', true);
        document.getElementById("submit2").style.color = "grey";
        socket.emit('send_buzz', mystorage.getItem('id'));
    }
    ;


</script>

<body>


<div id="clientsite">

    <div id="submit">
        <!--    <img id="logo_Jeopardy" src="graphics/gold_buzzcalu.png">-->
        <!--<img id="logo_Jeopardy" src="https://www.jeopardy.com/Assets/jeopardy/images/global/logo_jeopardy.png">-->

        <p id="subheading">
            Bitte Namen eingeben:
        </p>
        <input id="username" type="text" name="username" placeholder="Username">


    <button id="submit-btn" onclick="save_name()"  type="button">
        Save Name
    </button>
    </div>
    <div id="submit2" style="visibility:hidden;">

        <!--<div id="submit2" style="visibility:hidden;">-->

        <h1 id="buzz-text" ></h1>
        <button id="buzzerBtn"
                onclick="send_buzz()"
                type="button" disabled>

            Buzz!
        </button>

    </div>
</div>
<!--


<div id="UserInterface">
<p id="subheading">
    Bitte Namen eingeben:
</p>
<input id="username" type="text" name="username" placeholder="Username">
<br/>

<div id="submit">
    <button id="submit-btn" onclick="save_name()" type="button">
        Save Name
    </button>
</div>

</div>

<div id="submit2" >
    <h1 id="buzz-text">Be Ready ###</h1>
    <button id="buzzerBtn"
            onclick="send_buzz()"
            type="button" disabled>

        Buzz!
    </button>

</div>



<form action="">
    <div id="UserInterface">

        <h1 id="subheading">Bitte Namen eingeben</h1>

        <input id="username" autocomplete="off"/>
        <button type="button" id="submit-btn" onclick="save_name()">Save Name</button>
    </div>


    <div id="buzz-div" style="visibility:hidden;">
        <h1 id="buzz-text">Be Ready ###</h1>
        <button type="button"
                onclick="send_buzz()"
                id="buzzerBtn">

            Buzz!
        </button>

    </div>
    <div>

    </div>
</form>-->
</body>
</html>
