<!doctype html>
<html>
<head>
    <title>Client</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="libraries/jquery-3.2.1.min.js"></script>
    <link href="styles/client.css" rel="stylesheet">
    <!--    <link href="styles/overview.css" rel="stylesheet">-->
    <script language="javascript" type="text/javascript" src="js/client.js"></script>
    <script src="node_modules/socket.io-client/dist/socket.io.js"></script>
</head>


<script>
    var obj = {},
        socket = io.connect(),
        mystorage = localStorage;

    var ich = {};
    //Daten vom Server empfangen bzw
    //socket.on = connect listener
    // var text = ('{"name"}')

        console.log("storage: " + mystorage.getItem('nickname'));
    if (mystorage.getItem('nickname')!= null){
        window.onload = save_name;
    }

    function save_name() {
        if (mystorage.getItem('nickname') == null) {
            console.log("Neuanmeldung, als: " + $('#username').val());
            // mystorage.getItem(obj.nickname);


            document.getElementById("username").disabled = true;
            document.getElementById("username").style = "visibility:hidden;";
            document.getElementById("submit-btn").disabled = true;

            //   document.getElementById("subheading").style = "visibility:hidden;";
            document.getElementById("submit-btn").style = "visibility:hidden;";

            obj = ({"id": 100, "nickname": $('#username').val(), "pkte": 0, "gameColor": "white"});
            mystorage.setItem('nickname', $('#username').val());
            mystorage.setItem('id', "100");
            console.log("insavename storeg: " + mystorage.getItem('nickname'));

            console.log("Hallo storage: " + mystorage.getItem('nickname'));
            console.log("Hallo  obj: " + obj.nickname);


            socket.emit('set nickname', obj);
            // var myJSON = JSON.stringify(obj);
        } else {
            //  document.getElementById("username").disabled = true;
            console.log("richtig");
            //  $('#username').val(mystorage.getItem('nickname'));
            document.getElementById('submit-btn').style = "visibility:hidden;";
            document.getElementById("username").style = "visibility:hidden;";
            document.getElementById("submit-btn").disabled = true;
            document.getElementById("buzzerBtn").style = "visibility:visible;";
            $('#subheading').text("Du bist bereits als: " + mystorage.getItem('nickname') + " eingeloggt, also sei bereit, " + mystorage.getItem('nickname') + "!");


        }

    };

    /*socket.on('connect', () => {
        // ...
    });

    // note: you should register event handlers outside of connect,
    // so they are not registered again on reconnection
    socket.on('myevent', () => {
        // ...
    });
    Event: 'disconnect'
    reason (String) either 'io server disconnect' or 'io client disconnect'

    Fired upon a disconnection.

    socket.on('disconnect', (reason) => {
        // ...
    });
#Event: 'reconnect'
    attempt (Number) reconnection attempt number
    Fired upon a successful reconnection.

    socket.on('reconnect', (attemptNumber) => {
        // ...
    });
#Event: 'reconnect_attempt'
    attempt (Number) reconnection attempt number
    Fired upon an attempt to reconnect.

    socket.on('reconnect_attempt', (attemptNumber) => {
        // ...
    });
#Event: 'reconnecting'
    attempt (Number) reconnection attempt number
    Fired upon an attempt to reconnect.

    socket.on('reconnecting', (attemptNumber) => {
        // ...
    });
#Event: 'reconnect_error'
    error (Object) error object
    Fired upon a reconnection attempt error.

    socket.on('reconnect_error', (error) => {
        // ...
    });*/


    socket.on('playerList', function(obj, playerArray){
        mystorage.setItem('nickname', obj.nickname); //speichern eines Eintrags mit 2 Werten.

        //  keyName: Name des Eintrags
        // keyValue: string mit zu speicherndem Eintrag
        document.getElementById("buzzerBtn").style = "visibility:visible;";
        $('#subheading').text("Sei bereit, " + obj.nickname + "!");
    });


    socket.on('fastest player', function (player) {

        console.log("fastest player funzt: " + player.nickname);
        //BuzzerBtn ausgrauen, um ihn nur einmal drücken zu können.
        $('#buzzerBtn').prop('disabled', true);

        console.log("ich.nickname: " + obj.nickname);
        if (player.nickname == obj.nickname) {
            $('#buzz-text').text("Glückwunsch, Du bist dran!");
            changeColor('green');
        }
        else {
            $('#buzz-text').text("Zu Langsam, " + player.nickname + " ist dran!");
            changeColor('grey');
        }
    });

       socket.on('trueAnswer', function (druecker, drueckerArray, questionArray) {
     console.log(druecker.nickname + " kriegt Punkte!!");
           $('#buzzerBtn').prop('disabled', true);
           changeColor('white');
     });

     socket.on('wrongAnswer', function (druecker, drueckerArray) {
     console.log(druecker.nickname + " kriegt leider keine Punkte!!");
         $('#buzzerBtn').prop('disabled', false);
         //Buzzer wieder disablen
         changeColor('white');
     });

    //Buzzer wieder enablen!
    socket.on('showQuestion', function (questionArray5, tdId5, indx5) {
        $('#buzzerBtn').prop('disabled', false);
        $('#buzz-text').text("Sei bereit, " + $('#username').val() + "!");

    });

    socket.on('showPicture', function (questionArray5, tdId5, indx5) {
        $('#buzzerBtn').prop('disabled', false);
        $('#buzz-text').text("Sei bereit, " + $('#username').val() + "!");

    });

    socket.on('showSuperQuestion', function (questionArray5, tdId5, indx5) {
        $('#buzzerBtn').prop('disabled', false);
        $('#buzz-text').text("Sei bereit, " + $('#username').val() + "!");

    });

    var currColor;
    function changeColor(colorName) {
        document.body.style.backgroundColor = colorName;
        currColor = colorName;
    }


    function send_buzz() {
        var socket = io();

        console.log("send_buzz Test: " + $('#username').val());
        // Eigenes Event vom Client an den Server schicken
        //  socket.emit('send_buzz', $('#username').val());
        socket.emit('send_buzz', obj);

        //  return false;
    }
    ;


</script>

<body>


<div id="UserInterface">
    <img id="logo_Jeopardy" src="graphics/gold_buzzcalu.png">
    <!--<img id="logo_Jeopardy" src="https://www.jeopardy.com/Assets/jeopardy/images/global/logo_jeopardy.png">-->
    <p id="subheading">
        Bitte Namen eingeben:
    </p>
    <input id="username" type="text" name="username" placeholder="Username">
    <br/>

    <div id="submit">
        <button id="submit-btn" onclick="save_name()" type="button" >
            Save Name
        </button>
    </div>
    <div id="submit" style="visibility:hidden;">
        <h1 id="buzz-text">Be Ready ###</h1>
        <button id="buzzerBtn"
            onclick="send_buzz()"
            type="button" disabled>

            Buzz!
        </button>

    </div>
</div>

<!--<form action="">
    <div id="UserInterface">

        <h1 id="subheading">Bitte Namen eingeben</h1>

        <input id="username" autocomplete="off"/>
        <button type="button" id="submit-btn" onclick="save_name()">Save Name</button>
    </div>


    <div id="buzz-div" style="visibility:hidden;">
        <h1 id="buzz-text">Be Ready ###</h1>
        <button type="button"
                onclick="send_buzz()"
                id="buzzerBtn">

            Buzz!
        </button>

    </div>
    <div>

    </div>
</form>-->
</body>
</html>
