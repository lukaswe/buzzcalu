<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BuzzCaLu Overview Screen</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="libraries/jquery-3.2.1.min.js"></script>
    <script src="libraries/jquery.blink.js"></script>
    <link href="styles/overview.css" type="text/css" rel="stylesheet">
    <script src="libraries/zoomooz-master/jquery.zoomooz.js"></script>

</head>

<script>

    var socket = io(),
        playerArray =[],
        questionArrayOv = [],
        i = 1,
        j = 0,
        tdId = 0,
        indx = 0,
        prevTdId = 0,
        mystorage = localStorage;


    $(document).ready(function () {
        if (mystorage.getItem('playerArrayStorage') !== null){
//        if (playerArray.length > 0) {
            console.log("Backto");
            //playerArray = playerArray6;
            //   console.log("[tdId]:   " + [tdId]);
            //   console.log("answerArray[tdId]:   " + answerArray[indx].text);
          //  answerStart(answerArray, tdId, indx);
            prevTdId = tdId;
            playerArray = JSON.parse(mystorage.getItem('playerArrayStorage'));

           // console.log('prevTdiDi: ' + prevTdId);
            fillNameFields(playerArray);

        //    document.getElementById('grayout').style = "display: none";
        }else{alert("leer");}
    });





    socket.on('reconnect3', function (playerArray7) {
        //Array mit Spielern füllen
        playerArray = playerArray7;
        console.log('reconnected & playerarray: ' + playerArray);
        mystorage.setItem('playerArrayStorage', JSON.stringify(playerArray));
        fillNameFields(playerArray);
    });


    //Clients verbinden sich //Blaue Felder füllemn :)
    socket.on('playerList', function (nicknameObj, playerArray7) {
        //Array mit Spielern füllen
        playerArray = playerArray7;
        console.log(nicknameObj.nickname + " just connected!");
        console.log(nicknameObj.nickname + " just connected!");
        var x = 0;
        playerArray.forEach(function(player) {
            mystorage.setItem('playerArrayStorage[x]', JSON.stringify(player));

            console.log("jsonstring: " + mystorage.getItem('playerArrayStorage[x]'));
            x++;
        });


        mystorage.setItem('playerArrayStorage', JSON.stringify(playerArray));
        fillNameFields(playerArray);
    });



    socket.on('trueAnswer', function (player, playerArray5, answerArray) {
        playerArray = playerArray5;
     //   console.log("[tdId]:   " + [tdId]);
     //   console.log("answerArray[tdId]:   " + answerArray[indx].text);
        answerStart(answerArray, tdId, indx);
        prevTdId = tdId;
        console.log('prevTdiDi: '+ prevTdId);
        fillNameFields(playerArray);
        /*for (y = 0; y < 15; y++) {

         document.getElementById("question" + y).style.height = 150 + "px";
         document.getElementById("question" + y).style.width = 25 + "%";

         }*/
        //$('#question23').click();
        document.getElementById('grayout').style="display: none";
    });

    socket.on('giveUp', function (player, playerArray5, answerArray) {
        playerArray = playerArray5;
     //   console.log("[tdId]:   " + [tdId]);
     //   console.log("answerArray[tdId]:   " + answerArray[indx].text);
        answerStart(answerArray, tdId, indx);
        prevTdId = tdId;
        console.log('prevTdiDi: '+ prevTdId);
        fillNameFields(playerArray);

        document.getElementById('grayout').style="display: none";
    });


    socket.on('wrongAnswer', function (player, playerArray9) {
        playerArray = playerArray9;
        //playerArray.forEach(function (player) {
        //   if (schnellster.nickname == player.nickname) {
        //       console.log("player.pkte: " + player.pkte);
        //  player.pkte = schnellster.pkte;
        fillNameFields(playerArray9);
        //    }

        // });
    });


    socket.on('backToOverview', function (playerArray6) {
        console.log("Backto");
        playerArray = playerArray6;
        //   console.log("[tdId]:   " + [tdId]);
        //   console.log("answerArray[tdId]:   " + answerArray[indx].text);
        answerStart(answerArray, tdId, indx);
        prevTdId = tdId;
        console.log('prevTdiDi: '+ prevTdId);
        fillNameFields(playerArray);

        document.getElementById('grayout').style="display: none";
    });
    socket.on('fastest player', function (player) {
        //document.getElementById("erster-text").innerHTML = player;
        $('#erster-text').text(player.nickname);
        playerArray.forEach(function (player2) {
            console.log("player2.nickname" + player2.nickname);
            if (player2.id == player.id) {
                console.log("das geht jetzt mal " + player2.id + " = " + player.id);
                //  document.getElementById("player" + player2.id + "-name").style = "visibility: hidden;";
            }
        });

    });


    socket.on('showQuestion', function (questionArray, tdId2, indx2) {
        tdId = tdId2;
        indx = indx2;
        console.log("tdId : " + tdId);
        console.log("qA: " + questionArray[indx].text);
       // if (questionArray[indx].text == "Bild") {
        //    bildStart(questionArray, tdId, indx);
       // } else {

            console.log("this.questionArray.val " + questionArray[indx].val);
            questionStart2(questionArray, tdId, indx);
       // }
    });


    var que;
    socket.on('showSuperQuestion', function (questionArray, tdId2, indx2) {

        que = '#question' + indx2;
        // blink('#question'+indx2);
        console.log("$(que:)" + que);
        blink($(que));

        tdId = tdId2;
        indx = indx2;
        console.log("superQuestion");
        //console.log("qA: " + questionArray[indx].text);
        //console.log("this.questionArray.val" + questionArray[indx].val);
        questionStart2(questionArray, tdId, indx);
    });

    socket.on('showPicture', function (questionArray, tdId2, indx2) {

        que = '#question' + indx2;
        console.log("$(que:)" + que);

        tdId = tdId2;
        indx = indx2;
        if (prevTdId != 0){
            document.getElementById(prevTdId).innerHTML = '';
        }
        console.log("showPicture!!!");
        window.location.replace('http://localhost:3000/picturing')
    });


    socket.on('showNothing', function (questionArray, tdId, indx) {
        console.log("qA: " + questionArray[indx].text + " , " + questionArray[indx].val);
        console.log("this.questionArray.val" + questionArray[indx].val);
        //  questionStart2(questionArray, tdId, indx);
        document.getElementById(tdId).innerHTML = "";

    });


    //Antwort in Tabelle eintragen
    function answerStart(answerArray, tdId, indx) {
        document.getElementById(tdId).innerHTML = answerArray[indx];
    }

    //Frage in Tabelle eintragen
    function questionStart2(questionArray, tdId, indx) {
        //  console.log("j: " + this.j);
        var question = questionArray[indx];
        console.log("question: " + question.text);
     //   console.log("question2: " + questionArray[indx].text);
     //   console.log("tdId:: " + tdId);

        /** letztes Fragenfeld leeren**/
        if (prevTdId != 0){
            document.getElementById(prevTdId).innerHTML = '';
        }
        document.getElementById(tdId).innerHTML = question.text;


    }



    //Blaue Namensfelder werden befüllt
    function fillNameFields(playerArray2) {
        i = 0;
        console.log("hmmm");
        playerArray2.forEach(function (player) {
            $('#player' + i + '-name').text(player.nickname + '    ' + player.pkte);

            document.getElementById("player" + i + "-name").style = "visibility:visible";
            document.getElementById("player" + i + "-name").style.backgroundColor = player.color;

            i += 1;
        });

    }

 /*   $(document).ready(function () {
        $("#question23").click(function (evt) {
            $(this).zoomTo({targetsize: 1.15, duration: 600, debug: true});
            evt.stopPropagation();
        });
        $("#question23").click(function (evt) {
            $(".zoomTarget").zoomTo({targetsize: 1, duration: 600, debug: true});
            evt.stopPropagation();
        });
      //  $(".zoomTarget").zoomTo({targetsize: 1.0, debug: true});
    });
*/



</script>


<body>
<!--<div id="grayout" style="display: none;"></div>-->

<!--<a href="#" id=grayout onclick="$('#grayout').toggle(900); return false;">GrayOut</a>-->
<!--Zoom Classen-->
<!--
<div class="zoomViewport">
    <div class="zoomContainer">

        <div class="zoomTarget" data-closeclick="true data-targetsize="1" id="question20">100</div>
        <div class="zoomTarget" data-closeclick="true data-targetsize="1" id="question21">100</div>
        <div class="zoomTarget" data-closeclick="true data-targetsize="1" id="question22">100</div>
        <div class="zoomTarget" data-closeclick="true data-targetsize="1" id="question23">100</div>

    </div>
</div>
-->

<div><h1 id="heins">Wer ist dran?</h1></div>
<div id="erster">
    <h3 id="erster-text"> ... </h3>
</div>


<!--Fragen Tabelle-->

<div class="questionContainer-css">

    <table id="playerTable" class="questionUeberschrift-css">
        <thead>
        <tr>
            <th>Leben</th>
            <th>Conny</th>
            <th>Christian</th>
            <th>Romantisch</th>
            <th>Schätzfragen</th>


        </tr>
        </thead>
        <tbody id="ctbody">
        <tr>

            <!--   <td class="zoomTarget" id="question0">100</td>
             <td class="zoomTarget" id="question1">100</td>
             <td class="zoomTarget" id="question2">100</td>
             <td class="zoomTarget" id="question3">100</td>-->
            <td class="questionBoxes-css" id="question0">100</td>
            <td class="questionBoxes-css" id="question1">100</td>
            <td class="questionBoxes-css" id="question2">100</td>
            <td class="questionBoxes-css" id="question3">100</td>
            <td class="questionBoxes-css" id="question4">100</td>
        </tr>
        <tr>

            <td class="questionBoxes-css" id="question5">200</td>
            <td class="questionBoxes-css" id="question6">200</td>
            <td class="questionBoxes-css" id="question7">200</td>
            <td class="questionBoxes-css" id="question8">200</td>
            <td class="questionBoxes-css" id="question9">200</td>
        </tr>
        <tr>
            <td class="questionBoxes-css" id="question10">300</td>
            <td class="questionBoxes-css" id="question11">300</td>
            <td class="questionBoxes-css" id="question12">300</td>
            <td class="questionBoxes-css" id="question13">300</td>
            <td class="questionBoxes-css" id="question14">300</td>

        </tr>
        <tr>

            <td class="questionBoxes-css" id="question15">400</td>
            <td class="questionBoxes-css" id="question16">400</td>
            <td class="questionBoxes-css" id="question17">400</td>
            <td class="questionBoxes-css" id="question18">400</td>
            <td class="questionBoxes-css" id="question19">400</td>
            <!--      <td id="question19" onclick="bildAnzeigen();return false"><img src="graphics/400.png"/></td> -->
        </tr>




        </tbody>

    </table>


</div>
<!--<ul>
    <li><a href="#bild1"><img src="bild1_klein.jpg"/></a></li>
    <li><a href="#bild2"><img src="bild1_klein.jpg"/></a></li>
    <li><a href="#bild3"><img src="bild1_klein.jpg"/></a></li>
</ul>

<ul class="lightbox">
    <li id="bild1"><a href="#start"><img src="bild1.jpg"/></a></li>
    <li id="bild2"><a href="#start"><img src="bild1.jpg"/></a></li>
    <li id="bild3"><a href="#start"><img src="bild1.jpg"/></a></li>
</ul>
-->
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


<!-- beigetretene Spieler Anzeige -->
<div class="playerNameContainer" id=playerNameContainerId>
    <div class="playerNameBoxes-css" id="player0-name">Enjoy</div>
    <div class="playerNameBoxes-css" id="player1-name">Enjoy</div>
    <div class="playerNameBoxes-css" id="player2-name">Enjoy</div>
    <div class="playerNameBoxes-css" id="player3-name">Enjoy</div>
    <div class="playerNameBoxes-css" id="player4-name">Enjoy</div>
</div>


</body>
</html>
